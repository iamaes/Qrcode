<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Knapperige kabouterhapjes - QR Scan</title>
    <script src="https://unpkg.com/html5-qrcode"></script>

    <style>
        /* Basisstijlen voor volledig scherm op iPad (10.2" Viewport is 810x1080 of 1080x810 CSS Pixels) */
        html, body {
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
            display: flex;
            background-color: #f0f0f0;
        }

        /* Hoofdcontainer: verdeelt de ruimte (zijbalk en hoofdinhoud) */
        .container {
            display: flex;
            width: 100%;
            height: 100%;
        }

        /* Linker zijbalk voor ingrediëntafbeeldingen */
        .sidebar {
            width: 20%;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            align-items: center;
            padding: 10px 0;
            background-color: #E5DCAF;
        }

        .ingredient-item {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 5px;
        }

        .ingredient-img {
            width: 80px;
            height: 80px;
            object-fit: contain;
            transition: border 0.3s;
            border: 5px solid transparent;
            border-radius: 10px;
        }

        .ingredient-img.found {
            border: 5px solid green;
        }

        /* Hoofdinhoud (titel, knop, actie-schermen) */
        .main-content {
            width: 80%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
            position: relative;
        }

        /* Titel */
        .header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            width: 100%;
            justify-content: center;
        }

        .header h1 {
            font-size: 3em;
            color: #333;
            margin: 0;
        }

        /* Startscherm */
        #start-screen {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        #start-button {
            padding: 50px 100px;
            font-size: 3em;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 15px;
            box-shadow: 0 10px 0 #38763a;
            transition: all 0.1s;
        }

        #start-button:active {
            box-shadow: 0 5px 0 #38763a;
            transform: translateY(5px);
        }
        
        /* Zoekscherm */
        .search-screen {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex-grow: 1;
            width: 100%;
        }

        .search-screen h2 {
            font-size: 2.5em;
            color: #555;
            margin-top: 0;
            margin-bottom: 20px;
        }

        .search-screen img.large-ingredient {
            width: 200px;
            height: 200px;
            object-fit: contain;
            margin-bottom: 30px;
        }

        /* 2. Style de container voor de QR-scanner-feed */
        #reader {
            width: 400px;
            height: 300px;
            border: 5px solid #ccc;
            border-radius: 10px;
            /* html5-qrcode beheert de video-tag en spiegeling */
        }

        /* Receptscherm (onveranderd) */
        #recipe-screen {
            display: none;
            flex-direction: column;
            align-items: flex-start;
            flex-grow: 1;
            width: 80%;
            max-width: 700px;
            text-align: left;
            margin-top: 20px;
            padding: 20px;
            border: 2px solid #555;
            border-radius: 15px;
            background-color: white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        #recipe-screen h2 {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #38763a;
            width: 100%;
            text-align: center;
        }

        #recipe-screen h3 {
            font-size: 1.8em;
            margin-top: 20px;
            border-bottom: 2px solid #38763a;
            padding-bottom: 5px;
        }

        #recipe-screen p, #recipe-screen li {
            font-size: 1.4em;
            line-height: 1.5;
            margin-bottom: 10px;
        }

        #recipe-screen ul {
            list-style-type: none;
            padding-left: 0;
        }

        #recipe-screen button {
            margin-top: 30px;
            padding: 15px 30px;
            font-size: 1.5em;
            cursor: pointer;
            background-color: #333;
            color: white;
            border: none;
            border-radius: 8px;
            width: 100%;
        }

        /* Confetti Effect (onveranderd) */
        #confetti-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #ff00ff, #00ffff, #ffff00, #ff0000);
            opacity: 0;
            transition: opacity 0.1s;
            pointer-events: none;
            z-index: 20;
            display: none;
            border-radius: 10px;
        }
        
    </style>
</head>
<body>

    <div class="container">
        <div class="sidebar">
            <div class="ingredient-item">
                <img id="img-oesterzwam" class="ingredient-img" src="oesterzwam.png" alt="Oesterzwam" data-name="oesterzwam">
            </div>
            <div class="ingredient-item">
                <img id="img-olijfolie" class="ingredient-img" src="olijfolie.png" alt="Olijfolie" data-name="olijfolie">
            </div>
            <div class="ingredient-item">
                <img id="img-rozemarijn" class="ingredient-img" src="rozemarijn.png" alt="Rozemarijn" data-name="rozemarijn">
            </div>
            <div class="ingredient-item">
                <img id="img-tijm" class="ingredient-img" src="tijm.png" alt="Tijm" data-name="tijm">
            </div>
        </div>

        <div class="main-content">
            <div class="header">
                <h1>Knapperige kabouterhapjes</h1>
            </div>

            <div id="start-screen">
                <button id="start-button">START!</button>
            </div>

            <div id="search-screen" class="search-screen">
                <h2 id="search-text">Zoek dit ingrediënt: OESTERZWAM</h2>
                <img id="large-ingredient-img" class="large-ingredient" src="" alt="Groot ingrediënt">
                
                <div id="reader"></div>
            </div>

            <div id="recipe-screen">
                <h2>Het Recept</h2>
                <h3>Ingrediënten:</h3>
                <ul>
                    <li>250 g oesterzwammen</li>
                    <li>2 eetlepels olijfolie</li>
                    <li>1 takje rozemarijn</li>
                    <li>1 takje tijm</li>
                </ul>
                <h3>Bereidingswijze:</h3>
                <ol>
                    <li>Maak de oesterzwammen schoon.</li>
                    <li>Laat je kind voorzichtig ruiken aan de oesterzwammen (optioneel).</li>
                    <li>Verhit de pan met olijfolie.</li>
                    <li>Voeg de oesterzwammen toe en bak ze goudbruin.</li>
                    <li>Voeg de kruiden toe en serveer.</li>
                </ol>
                <p style="font-size: 2em; text-align: center; width: 100%; color: #e74c3c;">**Smakelijk!**</p>
                <button id="reset-button">Terug naar Start</button>
            </div>
            
            <div id="confetti-overlay"></div>
        </div>
    </div>

    <script>
        const ingredients = [
            // Aangepast: 'name' en 'qrCodeText' zijn nu meervoud. 'htmlIdName' is de koppeling naar HTML ID.
            { name: "oesterzwammen", htmlIdName: "oesterzwam", file: "oesterzwam.png", qrCodeText: "oesterzwammen" }, 
            { name: "olijfolie", htmlIdName: "olijfolie", file: "olijfolie.png", qrCodeText: "olijfolie" },
            { name: "rozemarijn", htmlIdName: "rozemarijn", file: "rozemarijn.png", qrCodeText: "rozemarijn" },
            { name: "tijm", htmlIdName: "tijm", file: "tijm.png", qrCodeText: "tijm" }
        ];

        let currentIngredientIndex = 0;
        let qrCodeScanner = null; // Opslag voor de scanner-instantie

        const startScreen = document.getElementById('start-screen');
        const searchScreen = document.getElementById('search-screen');
        const recipeScreen = document.getElementById('recipe-screen');
        const startButton = document.getElementById('start-button');
        const searchHeader = document.getElementById('search-text');
        const largeIngredientImg = document.getElementById('large-ingredient-img');
        const confettiOverlay = document.getElementById('confetti-overlay');
        const resetButton = document.getElementById('reset-button');
        
        // Functie voor spraaksynthese
        function speak(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'nl-NL'; 
                window.speechSynthesis.speak(utterance);
            } else {
                console.warn('Speech Synthesis niet ondersteund in deze browser.');
            }
        }

        // Functie om de QR-scanner te starten
        async function startQrScanner() {
            const ingredient = ingredients[currentIngredientIndex];
            
            // Initialiseer de scanner als deze nog niet bestaat
            if (!qrCodeScanner) {
                // 'reader' is de ID van de div waar de video-feed in komt
                qrCodeScanner = new Html5Qrcode("reader");
            }
            
            // Configureer de scanner: gebruik de camera aan de voorkant ('user')
            const config = { 
                fps: 10, 
                qrbox: { width: 250, height: 250 }, 
                facingMode: "user" 
            };

            await qrCodeScanner.start(
                { facingMode: "user" },
                config,
                (decodedText, decodedResult) => {
                    // Deze functie wordt aangeroepen wanneer een QR-code wordt gedetecteerd
                    
                    // Controleer of de gescande tekst overeenkomt met het verwachte ingrediënt
                    if (decodedText.toLowerCase() === ingredient.qrCodeText) {
                        // Scan succesvol! Stop de scanner en ga verder.
                        qrCodeScanner.stop().then(() => {
                            ingredientFound();
                        }).catch(err => {
                            console.error("Fout bij stoppen van de scanner:", err);
                            ingredientFound(); // Ga toch verder
                        });
                    }
                },
                (errorMessage) => {
                    // Optioneel: log fouten, zoals 'geen QR-code gevonden'
                    // console.log(`QR Scan error: ${errorMessage}`); 
                }
            );
        }

        // Functie om de QR-scanner te stoppen
        function stopQrScanner() {
            if (qrCodeScanner && qrCodeScanner.isScanning) {
                qrCodeScanner.stop().catch(err => console.error("Fout bij stoppen scanner: ", err));
            }
        }

        // Start het zoekproces voor het huidige ingrediënt
        async function startSearch() {
            // Verberg alle schermen behalve Zoekscherm
            startScreen.style.display = 'none';
            recipeScreen.style.display = 'none';
            searchScreen.style.display = 'flex';

            const ingredient = ingredients[currentIngredientIndex];

            // Update hoofdinhoud (gebruikt nu de meervoudsvorm "oesterzwammen")
            searchHeader.textContent = `Zoek dit ingrediënt: ${ingredient.name.toUpperCase()}`;
            largeIngredientImg.src = ingredient.file;
            largeIngredientImg.alt = ingredient.name;
            
            // Computer zegt de tekst
            speak(`Zoek dit ingrediënt: ${ingredient.name}`);

            // Start de QR-scanner!
            await startQrScanner();
        }

        // Functie om het ingrediënt als 'gevonden' te markeren
        function ingredientFound() {
            const ingredient = ingredients[currentIngredientIndex];
            
            // 1. Groene rand
            // Aangepast: gebruikt 'htmlIdName' om te linken naar de singular ID in de HTML
            const sideImg = document.getElementById(`img-${ingredient.htmlIdName}`); 
            if (sideImg) {
                sideImg.classList.add('found');
            }

            // 2. Confetti effect (2 seconden)
            confettiOverlay.style.display = 'block';
            confettiOverlay.style.opacity = '1';
            
            setTimeout(() => {
                confettiOverlay.style.opacity = '0';
                setTimeout(() => {
                    confettiOverlay.style.display = 'none';
                    
                    // Ga naar het volgende ingrediënt of toon het recept
                    currentIngredientIndex++;
                    if (currentIngredientIndex < ingredients.length) {
                        startSearch(); // Volgende ingrediënt
                    } else {
                        showRecipe(); // Recept
                    }
                }, 500); // Kortere timeout om de animatie te voltooien
            }, 2000);
        }

        // Toon het receptscherm
        function showRecipe() {
            stopQrScanner();
            searchScreen.style.display = 'none';
            recipeScreen.style.display = 'flex';
            speak("Gefeliciteerd! Alle ingrediënten zijn gevonden. Hier is het recept. Smakelijk!");
        }

        // Reset naar de startstatus
        function resetGame() {
            stopQrScanner();
            currentIngredientIndex = 0;
            
            // Reset zijbalkafbeeldingen
            document.querySelectorAll('.ingredient-img').forEach(img => {
                img.classList.remove('found');
            });
            
            // Toon startscherm
            searchScreen.style.display = 'none';
            recipeScreen.style.display = 'none';
            startScreen.style.display = 'flex';
        }

        // EVENT LISTENERS
        startButton.addEventListener('click', startSearch);
        resetButton.addEventListener('click', resetGame);
        
        // Start de applicatie in de reset-modus
        resetGame();

    </script>
</body>
</html>
